<div class="poster-rows" aria-hidden="true">
  <div class="row r1"><div class="inner"></div></div>
  <div class="row r2"><div class="inner"></div></div>
  <div class="row r3"><div class="inner"></div></div>
  <div class="row r4"><div class="inner"></div></div>
  <div class="row r5"><div class="inner"></div></div>
  <div class="row r6"><div class="inner"></div></div>
  <div class="row r7"><div class="inner"></div></div>
  <div class="row r8"><div class="inner"></div></div>
  <div class="row r9"><div class="inner"></div></div>
  <div class="row r10"><div class="inner"></div></div>
</div>

<nav class="sidebar" [class.active]="sidebarService.sidebarActive()">
  <div class="logo-menu">
    <h2 class="logo">What2Watch</h2>
    <i class="bx bx-menu toggle-button" (click)="sidebarService.toggle()"></i>
  </div>

  <ul class="list">
    <li class="list-item">
      <a (click)="routingService.navigateToHome()">
        <i class="bx bx-home-alt"></i>
        <span class="link-name" [style.--i]="sidebarService.navDelay(0, filmKind())">Home</span>
      </a>
    </li>

    <li class="list-item">
      <a (click)="routingService.navigateToSearchMovies()">
        <i class="bx bx-search"></i>
        <span class="link-name" [style.--i]="sidebarService.navDelay(1, filmKind())">Search</span>
      </a>
    </li>

    <li class="list-item" [class.active]="filmKind()==='movie'">
      <a (click)="routingService.navigateToMoviesLibrary()">
        <i class="bx bx-camera-movie"></i>
        <span class="link-name" [style.--i]="sidebarService.navDelay(2, filmKind())">Movies</span>
      </a>
    </li>
    
    <ng-container *ngIf="filmKind()==='movie'">
      <li class="films-item active">
        <a class="library-icon" (click)="routingService.navigateToMoviesLibrary()">
          <i class='bx  bx-list-ul'></i>
          <span class="link-name" [style.--i]="sidebarService.navDelay(2, filmKind())">Library</span>
        </a>
      </li>
      <li class="films-item" >
        <a class="summary-icon" (click)="routingService.navigateToMoviesSummary()">
          <i class='bx bx-bar-chart-alt-2'></i>
          <span class="link-name" [style.--i]="sidebarService.navDelay(2, filmKind())">Summary</span>
        </a>
      </li>
    </ng-container>

    <li class="list-item" [class.active]="filmKind()==='series'">
      <a (click)="routingService.navigateToShowsLibrary()">
        <i class="bx bx-collection"></i>
        <span class="link-name" [style.--i]="sidebarService.navDelay(3, filmKind())">Shows</span>
      </a>
    </li>

    <ng-container *ngIf="filmKind()==='series'">
      <li class="films-item">
        <a class="library-icon" (click)="routingService.navigateToShowsLibrary()">
          <i class='bx  bx-list-ul'></i>
          <span class="link-name" [style.--i]="sidebarService.navDelay(3, filmKind())">Library</span>
        </a>
      </li>
      <li class="films-item active">
        <a class="summary-icon" (click)="routingService.navigateToShowsSummary()">
          <i class='bx bx-bar-chart-alt-2'></i>
          <span class="link-name" [style.--i]="sidebarService.navDelay(3, filmKind())">Summary</span>
        </a>
      </li>
    </ng-container>

    <li class="list-item">
      <a (click)="routingService.navigateToAccountsPosts(currentUser.username)">
        <i class="bx bx-user"></i>
        <span class="link-name" [style.--i]="sidebarService.navDelay(4, filmKind())">Account</span>
      </a>
    </li>

    <li class="list-item">
      <a (click)="routingService.navigateToSettings()">
        <i class="bx bx-cog"></i>
        <span class="link-name" [style.--i]="sidebarService.navDelay(5, filmKind())">Settings</span>
      </a>
    </li>

    <li class="username">
      <p class="link-name" [style.--i]="sidebarService.navDelay(6, filmKind())">Signed in as:</p>
      <p class="link-name" [style.--i]="sidebarService.navDelay(6, filmKind())">{{ currentUser.username }}</p>
    </li>
  </ul>
</nav>

<main class="dashboard">
  <!-- Cell 1: Favorites -->
  <section class="cell">
    <header class="cell-header">
      <button class="chev-btn prev"
              *ngIf="favoritesSequence().length > 1 && favIndex() > 0; else favPrevSpacer"
              (click)="prevFav()" aria-label="Previous favorite">‹</button>
      <ng-template #favPrevSpacer><span class="chev-spacer"></span></ng-template>

      <h3>{{ favTitle() }}</h3>

      <button class="chev-btn next"
              *ngIf="favoritesSequence().length > 1 && favIndex() < favoritesSequence().length - 1; else favNextSpacer"
              (click)="nextFav()" aria-label="Next favorite">›</button>
      <ng-template #favNextSpacer><span class="chev-spacer"></span></ng-template>
    </header>

    <div class="fav">
      <ng-container *ngIf="favoritesSequence().length; else noData">
        <ng-container *ngIf="favoritesSequence()[favIndex() % favoritesSequence().length] as f">
          <div class="fav-left">
            <img
              class="poster"
              [src]="posterOrFallback(f.poster)"
              (error)="onPosterError($event)"
              [alt]="f.movieTitle" />
          </div>
          <div class="fav-right">
            <div class="fav-title">{{ f.movieTitle }}</div>
            <div class="fav-meta">
              <span *ngIf="f.rating !== undefined" class="chip">Rating: {{ f.rating }}</span>
              <span *ngIf="f.rated" class="chip">{{ f.rated }}</span>
              <span class="chip" *ngIf="filmKind()==='movie'">{{ round(f.runtimeMin / 60) }}h {{ f.runtimeMin % 60 }}m</span>
            </div>
          </div>
        </ng-container>
      </ng-container>

      <ng-template #noData>
        <p class="empty">No data yet — rate some {{ filmKind()==='movie' ? 'movies' : 'shows' }}!</p>
      </ng-template>
    </div>
  </section>

  <!-- Cell 2: Totals -->
  <section class="cell">
    <header class="cell-header">
      <button class="chev-btn prev" *ngIf="countIndex() > 0; else totalsPrevSpacer" (click)="prevCount()" aria-label="Previous totals view">‹</button>
      <ng-template #totalsPrevSpacer><span class="chev-spacer"></span></ng-template>

      <h3>{{ totalsTitle() }}</h3>

      <button class="chev-btn next" *ngIf="countIndex() < 1; else totalsNextSpacer" (click)="nextCount()" aria-label="Next totals view">›</button>
      <ng-template #totalsNextSpacer><span class="chev-spacer"></span></ng-template>
    </header>

    <div class="totals content-flex">
      <div *ngIf="countIndex()===0" class="big-number">
        <div class="num">{{ totalItems() }} {{ filmKind()==='movie' ? 'Movies' : 'Shows' }}</div>
      </div>

      <div *ngIf="countIndex()===1" class="big-number">
        <div class="num" *ngIf="filmKind()==='movie'">{{ formatDuration(totalProgressUnit()) }}</div>
        <div class="num" *ngIf="filmKind()==='series'">{{ totalProgressUnit() }} Episodes</div>
      </div>

      <!-- Compact stat grid -->
      <div class="totals-extras">
        <!-- Movies: Longest & Shortest -->
        <div class="stat" *ngIf="filmKind()==='movie'">
          <div class="stat-value">{{ shortestMovieTitle() || '—' }}</div>
          <div class="stat-label">Shortest ({{ shortestMovieMinutes() }}m)</div>
        </div>
        <div class="stat" *ngIf="filmKind()==='movie'">
          <div class="stat-value">{{ longestMovieTitle() || '—' }}</div>
          <div class="stat-label">Longest ({{ longestMovieMinutes() }}m)</div>
        </div>

        <!-- Series: Most & Fewest episodes -->
        <div class="stat" *ngIf="filmKind()==='series'">
          <div class="stat-value">{{ fewestEpisodesTitle() || '—' }}</div>
          <div class="stat-label">Fewest episodes ({{ fewestEpisodesCount() }})</div>
        </div>
        <div class="stat" *ngIf="filmKind()==='series'">
          <div class="stat-value">{{ mostEpisodesTitle() || '—' }}</div>
          <div class="stat-label">Most episodes ({{ mostEpisodesCount() }})</div>
        </div>

        <!-- Common -->
        <div class="stat">
          <div class="stat-value">{{ ratingsExplored() }}</div>
          <div class="stat-label">Ratings explored</div>
        </div>
        <div class="stat">
          <div class="stat-value">{{ genresExplored() }}</div>
          <div class="stat-label">Genres explored</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Cell 3: Genres – bar charts -->
  <section class="cell">
    <header class="cell-header">
      <button class="chev-btn prev" *ngIf="genreBarIndex() > 0; else genreBarPrevSpacer" (click)="prevGenreBar()" aria-label="Previous genre chart">‹</button>
      <ng-template #genreBarPrevSpacer><span class="chev-spacer"></span></ng-template>

      <h3>{{ genreBarTitle() }}</h3>

      <button class="chev-btn next" *ngIf="genreBarIndex() < 2; else genreBarNextSpacer" (click)="nextGenreBar()" aria-label="Next genre chart">›</button>
      <ng-template #genreBarNextSpacer><span class="chev-spacer"></span></ng-template>
    </header>

    <div class="bars stretch">
      <ng-container [ngSwitch]="genreBarIndex()">
        <div *ngSwitchCase="0" class="bar-list scroll-box fill">
          <ng-container *ngIf="genreAvgRating() as data">
            <div class="bar-row" *ngFor="let d of data">
              <span class="bar-label">{{ d.label }}</span>
              <div class="bar-track"><div class="bar-fill" [style.width]="barPct(d.value, 10)"></div></div>
              <span class="bar-value">{{ d.value | number:'1.1-1' }}</span>
            </div>
          </ng-container>
        </div>

        <div *ngSwitchCase="1" class="bar-list scroll-box fill">
          <ng-container *ngIf="genreCount() as data">
            <div class="bar-row" *ngFor="let d of data">
              <span class="bar-label">{{ d.label }}</span>
              <div class="bar-track"><div class="bar-fill" [style.width]="barPct(d.value, maxValue(data))"></div></div>
              <span class="bar-value">{{ d.value }}</span>
            </div>
          </ng-container>
        </div>

        <div *ngSwitchDefault class="bar-list scroll-box fill">
          <ng-container *ngIf="genreProgress() as data">
            <div class="bar-row" *ngFor="let d of data">
              <span class="bar-label">{{ d.label }}</span>
              <div class="bar-track"><div class="bar-fill" [style.width]="barPct(d.value, maxValue(data))"></div></div>
              <span class="bar-value">
                {{ filmKind()==='movie' ? (d.value | number:'1.0-0') : d.value }}
              </span>
            </div>
          </ng-container>
        </div>
      </ng-container>
    </div>
  </section>

  <!-- Cell 4: Ratings – bar charts -->
  <section class="cell">
    <header class="cell-header">
      <button class="chev-btn prev" *ngIf="ratedBarIndex() > 0; else ratedBarPrevSpacer" (click)="prevRatedBar()" aria-label="Previous ratings chart">‹</button>
      <ng-template #ratedBarPrevSpacer><span class="chev-spacer"></span></ng-template>

      <h3>{{ ratedBarTitle() }}</h3>

      <button class="chev-btn next" *ngIf="ratedBarIndex() < 2; else ratedBarNextSpacer" (click)="nextRatedBar()" aria-label="Next ratings chart">›</button>
      <ng-template #ratedBarNextSpacer><span class="chev-spacer"></span></ng-template>
    </header>

    <div class="bars stretch">
      <ng-container [ngSwitch]="ratedBarIndex()">
        <div *ngSwitchCase="0" class="bar-list scroll-box fill">
          <ng-container *ngIf="ratedAvgRating() as data">
            <div class="bar-row" *ngFor="let d of data">
              <span class="bar-label">{{ d.label }}</span>
              <div class="bar-track"><div class="bar-fill" [style.width]="barPct(d.value, 10)"></div></div>
              <span class="bar-value">{{ d.value | number:'1.1-1' }}</span>
            </div>
          </ng-container>
        </div>

        <div *ngSwitchCase="1" class="bar-list scroll-box fill">
          <ng-container *ngIf="ratedCount() as data">
            <div class="bar-row" *ngFor="let d of data">
              <span class="bar-label">{{ d.label }}</span>
              <div class="bar-track"><div class="bar-fill" [style.width]="barPct(d.value, maxValue(data))"></div></div>
              <span class="bar-value">{{ d.value }}</span>
            </div>
          </ng-container>
        </div>

        <div *ngSwitchDefault class="bar-list scroll-box fill">
          <ng-container *ngIf="ratedProgress() as data">
            <div class="bar-row" *ngFor="let d of data">
              <span class="bar-label">{{ d.label }}</span>
              <div class="bar-track"><div class="bar-fill" [style.width]="barPct(d.value, maxValue(data))"></div></div>
              <span class="bar-value">
                {{ filmKind()==='movie' ? (d.value | number:'1.0-0') : d.value }}
              </span>
            </div>
          </ng-container>
        </div>
      </ng-container>
    </div>
  </section>

  <!-- Cell 5: Ratings – pie charts -->
  <section class="cell">
    <header class="cell-header">
      <button class="chev-btn prev" *ngIf="ratedPieIndex() > 0; else ratedPiePrevSpacer" (click)="prevRatedPie()" aria-label="Previous ratings share">‹</button>
      <ng-template #ratedPiePrevSpacer><span class="chev-spacer"></span></ng-template>

      <h3>{{ ratedPieTitle() }}</h3>

      <button class="chev-btn next" *ngIf="ratedPieIndex() < 1; else ratedPieNextSpacer" (click)="nextRatedPie()" aria-label="Next ratings share">›</button>
      <ng-template #ratedPieNextSpacer><span class="chev-spacer"></span></ng-template>
    </header>

    <div class="pies">
      <div class="pie-wrap">
        <div class="pie-shell">
          <div class="pie"
               [style.--hole.px]="65"
               [style.background]="pieGradient(ratedPieIndex()===0 ? ratedCountShare() : ratedProgressShare())"></div>
          <div class="pie-inner-border" [style.--hole.px]="65"></div>
          <div class="pie-center">
            <div class="pie-top">{{ ratedPieCenterTop() }}</div>
            <div class="pie-bottom">{{ ratedPieCenterBottom() }}</div>
          </div>
        </div>

        <ul class="legend scroll-box">
          <li *ngFor="let d of (ratedPieIndex()===0 ? ratedCountShare() : ratedProgressShare()); index as i">
            <span class="swatch" [style.background]="segmentColor(i)"></span>
            <span class="legend-label">{{ d.label }}</span>
            <small class="muted" *ngIf="ratedPieIndex()===1 && filmKind()==='movie'">({{ (d.value / 60) | number:'1.0-0' }} h)</small>
            <small class="muted" *ngIf="ratedPieIndex()===1 && filmKind()==='series'">({{ d.value }} ep)</small>
            <small class="muted" *ngIf="ratedPieIndex()===0">({{ d.value }})</small>
          </li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Cell 6: Genres – pie charts -->
  <section class="cell">
    <header class="cell-header">
      <button class="chev-btn prev" *ngIf="genrePieIndex() > 0; else genrePiePrevSpacer" (click)="prevGenrePie()" aria-label="Previous genre share">‹</button>
      <ng-template #genrePiePrevSpacer><span class="chev-spacer"></span></ng-template>

      <h3>{{ genrePieTitle() }}</h3>

      <button class="chev-btn next" *ngIf="genrePieIndex() < 1; else genrePieNextSpacer" (click)="nextGenrePie()" aria-label="Next genre share">›</button>
      <ng-template #genrePieNextSpacer><span class="chev-spacer"></span></ng-template>
    </header>

    <div class="pies">
      <div class="pie-wrap">
        <div class="pie-shell">
          <div class="pie"
               [style.--hole.px]="65"
               [style.background]="pieGradient(genrePieIndex()===0 ? genreCountShare() : genreProgressShare())"></div>
          <div class="pie-inner-border" [style.--hole.px]="65"></div>
          <div class="pie-center">
            <div class="pie-top">{{ genrePieCenterTop() }}</div>
            <div class="pie-bottom">{{ genrePieCenterBottom() }}</div>
          </div>
        </div>

        <ul class="legend scroll-box fill">
          <li *ngFor="let d of (genrePieIndex()===0 ? genreCountShare() : genreProgressShare()); index as i">
            <span class="swatch" [style.background]="segmentColor(i)"></span>
            <span class="legend-label">{{ d.label }}</span>
            <small class="muted" *ngIf="genrePieIndex()===1 && filmKind()==='movie'">({{ (d.value / 60) | number:'1.0-0' }} h)</small>
            <small class="muted" *ngIf="genrePieIndex()===1 && filmKind()==='series'">({{ d.value }} ep)</small>
            <small class="muted" *ngIf="genrePieIndex()===0">({{ d.value }})</small>
          </li>
        </ul>
      </div>
    </div>
  </section>
</main>